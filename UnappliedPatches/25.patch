From 898373801343065dcdbfce31943e617ecb8d601d Mon Sep 17 00:00:00 2001
From: Francois Lambert <flambert@mirego.com>
Date: Fri, 21 Jun 2013 14:21:18 -0400
Subject: [PATCH] Add flag to prevent changing the status bar style

Because changing the style can have unfortunate side effects
---
 TSMiniWebBrowser/TSMiniWebBrowser.h |  3 +++
 TSMiniWebBrowser/TSMiniWebBrowser.m | 15 +++++++++++----
 2 files changed, 14 insertions(+), 4 deletions(-)

diff --git a/TSMiniWebBrowser/TSMiniWebBrowser.h b/TSMiniWebBrowser/TSMiniWebBrowser.h
index 82d5a52..1a1d9a0 100644
--- a/TSMiniWebBrowser/TSMiniWebBrowser.h
+++ b/TSMiniWebBrowser/TSMiniWebBrowser.h
@@ -58,12 +58,14 @@
     BOOL showReloadButton;
     BOOL showActionButton;
     UIBarStyle barStyle;
+    BOOL changeStatusBarStyle;
 	UIColor *barTintColor;
     NSString *modalDismissButtonTitle;
     NSString *forcedTitleBarText;
     
     // State control
     UIBarStyle originalBarStyle;
+    UIBarStyle originalStatusBarStyle;
 }
 
 @property (assign) id<TSMiniWebBrowserDelegate> delegate;
@@ -74,6 +76,7 @@
 @property (nonatomic, assign) BOOL showReloadButton;
 @property (nonatomic, assign) BOOL showActionButton;
 @property (nonatomic, assign) UIBarStyle barStyle;
+@property (nonatomic, assign) BOOL changeStatusBarStyle;
 @property (nonatomic, strong) UIColor *barTintColor;
 @property (nonatomic, strong) NSString *modalDismissButtonTitle;
 @property (nonatomic, strong) NSString *domainLockList;
diff --git a/TSMiniWebBrowser/TSMiniWebBrowser.m b/TSMiniWebBrowser/TSMiniWebBrowser.m
index 0c8a9f5..2c21535 100644
--- a/TSMiniWebBrowser/TSMiniWebBrowser.m
+++ b/TSMiniWebBrowser/TSMiniWebBrowser.m
@@ -35,6 +35,7 @@ @implementation TSMiniWebBrowser
 @synthesize showReloadButton;
 @synthesize showActionButton;
 @synthesize barStyle;
+@synthesize changeStatusBarStyle;
 @synthesize modalDismissButtonTitle;
 @synthesize barTintColor;
 @synthesize domainLockList;
@@ -214,6 +215,7 @@ - (id)initWithUrl:(NSURL*)url {
         modalDismissButtonTitle = NSLocalizedString(@"Done", nil);
         forcedTitleBarText = nil;
         barStyle = UIBarStyleDefault;
+        changeStatusBarStyle = YES;
 		barTintColor = nil;
     }
     
@@ -252,9 +254,6 @@ - (void)viewDidLoad
         [self initTitleBar];
     }
     
-    // Status bar style
-    [[UIApplication sharedApplication] setStatusBarStyle:barStyle animated:YES];
-    
     // UI state
     buttonGoBack.enabled = NO;
     buttonGoForward.enabled = NO;
@@ -281,6 +280,12 @@ - (void) viewWillAppear:(BOOL)animated
 	}
 	
 	[webView.scrollView setScrollsToTop:YES];
+
+    // Status bar style
+    originalStatusBarStyle = [[UIApplication sharedApplication] statusBarStyle];
+    if (changeStatusBarStyle && originalStatusBarStyle != barStyle) {
+        [[UIApplication sharedApplication] setStatusBarStyle:barStyle animated:YES];
+    }
 }
 
 -(void) viewWillDisappear:(BOOL)animated {
@@ -292,7 +297,9 @@ -(void) viewWillDisappear:(BOOL)animated {
     }
     
     // Restore Status bar style
-    [[UIApplication sharedApplication] setStatusBarStyle:originalBarStyle animated:NO];
+    if (changeStatusBarStyle && originalStatusBarStyle != barStyle) {
+        [[UIApplication sharedApplication] setStatusBarStyle:originalStatusBarStyle animated:YES];
+    }
     
     // Stop loading
     [webView stopLoading];
-- 
1.8.4

